import{r as a,a as Me,b as Ue,R as Ne}from"./vendor-CJBOjUNh.js";import{R as Se,C as Ve,a as Te,X as Fe,Y as Ee,T as ke,A as Be,b as ie,c as He,L as Ye,d as Qe}from"./charts-C2N0aKi_.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function u(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function c(n){if(n.ep)return;n.ep=!0;const h=u(n);fetch(n.href,h)}})();var Ce={exports:{}},se={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ze=a,Ke=Symbol.for("react.element"),We=Symbol.for("react.fragment"),Xe=Object.prototype.hasOwnProperty,Je=ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ge={key:!0,ref:!0,__self:!0,__source:!0};function _e(t,r,u){var c,n={},h=null,y=null;u!==void 0&&(h=""+u),r.key!==void 0&&(h=""+r.key),r.ref!==void 0&&(y=r.ref);for(c in r)Xe.call(r,c)&&!Ge.hasOwnProperty(c)&&(n[c]=r[c]);if(t&&t.defaultProps)for(c in r=t.defaultProps,r)n[c]===void 0&&(n[c]=r[c]);return{$$typeof:Ke,type:t,key:h,ref:y,props:n,_owner:Je.current}}se.Fragment=We;se.jsx=_e;se.jsxs=_e;Ce.exports=se;var e=Ce.exports,de={},xe=Me;de.createRoot=xe.createRoot,de.hydrateRoot=xe.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function te(){return te=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(t[c]=u[c])}return t},te.apply(this,arguments)}var H;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(H||(H={}));const ge="popstate";function Ze(t){t===void 0&&(t={});function r(c,n){let{pathname:h,search:y,hash:d}=c.location;return me("",{pathname:h,search:y,hash:d},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function u(c,n){return typeof n=="string"?n:De(n)}return tt(r,u,null,t)}function Pe(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function et(){return Math.random().toString(36).substr(2,8)}function fe(t,r){return{usr:t.state,key:t.key,idx:r}}function me(t,r,u,c){return u===void 0&&(u=null),te({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof r=="string"?Re(r):r,{state:u,key:r&&r.key||c||et()})}function De(t){let{pathname:r="/",search:u="",hash:c=""}=t;return u&&u!=="?"&&(r+=u.charAt(0)==="?"?u:"?"+u),c&&c!=="#"&&(r+=c.charAt(0)==="#"?c:"#"+c),r}function Re(t){let r={};if(t){let u=t.indexOf("#");u>=0&&(r.hash=t.substr(u),t=t.substr(0,u));let c=t.indexOf("?");c>=0&&(r.search=t.substr(c),t=t.substr(0,c)),t&&(r.pathname=t)}return r}function tt(t,r,u,c){c===void 0&&(c={});let{window:n=document.defaultView,v5Compat:h=!1}=c,y=n.history,d=H.Pop,i=null,S=j();S==null&&(S=0,y.replaceState(te({},y.state,{idx:S}),""));function j(){return(y.state||{idx:null}).idx}function F(){d=H.Pop;let g=j(),m=g==null?null:g-S;S=g,i&&i({action:d,location:b.location,delta:m})}function _(g,m){d=H.Push;let s=me(b.location,g,m);S=j()+1;let $=fe(s,S),T=b.createHref(s);try{y.pushState($,"",T)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;n.location.assign(T)}h&&i&&i({action:d,location:b.location,delta:1})}function w(g,m){d=H.Replace;let s=me(b.location,g,m);S=j();let $=fe(s,S),T=b.createHref(s);y.replaceState($,"",T),h&&i&&i({action:d,location:b.location,delta:0})}function N(g){let m=n.location.origin!=="null"?n.location.origin:n.location.href,s=typeof g=="string"?g:De(g);return s=s.replace(/ $/,"%20"),Pe(m,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,m)}let b={get action(){return d},get location(){return t(n,y)},listen(g){if(i)throw new Error("A history only accepts one active listener");return n.addEventListener(ge,F),i=g,()=>{n.removeEventListener(ge,F),i=null}},createHref(g){return r(n,g)},createURL:N,encodeLocation(g){let m=N(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:_,replace:w,go(g){return y.go(g)}};return b}var ye;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ye||(ye={}));function st(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let u=r.endsWith("/")?r.length-1:r.length,c=t.charAt(u);return c&&c!=="/"?null:t.slice(u)||"/"}const $e=["post","put","patch","delete"];new Set($e);const rt=["get",...$e];new Set(rt);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ue(){return ue=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(t[c]=u[c])}return t},ue.apply(this,arguments)}const at=a.createContext(null),Le=a.createContext(null);function lt(){return a.useContext(Le)!=null}function nt(t,r){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function ot(t){let{basename:r="/",children:u=null,location:c,navigationType:n=H.Pop,navigator:h,static:y=!1,future:d}=t;lt()&&Pe(!1);let i=r.replace(/^\/*/,"/"),S=a.useMemo(()=>({basename:i,navigator:h,static:y,future:ue({v7_relativeSplatPath:!1},d)}),[i,d,h,y]);typeof c=="string"&&(c=Re(c));let{pathname:j="/",search:F="",hash:_="",state:w=null,key:N="default"}=c,b=a.useMemo(()=>{let g=st(j,i);return g==null?null:{location:{pathname:g,search:F,hash:_,state:w,key:N},navigationType:n}},[i,j,F,_,w,N,n]);return b==null?null:a.createElement(at.Provider,{value:S},a.createElement(Le.Provider,{children:u,value:b}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const it="6";try{window.__reactRouterVersion=it}catch{}const ct="startTransition",be=Ue[ct];function dt(t){let{basename:r,children:u,future:c,window:n}=t,h=a.useRef();h.current==null&&(h.current=Ze({window:n,v5Compat:!0}));let y=h.current,[d,i]=a.useState({action:y.action,location:y.location}),{v7_startTransition:S}=c||{},j=a.useCallback(F=>{S&&be?be(()=>i(F)):i(F)},[i,S]);return a.useLayoutEffect(()=>y.listen(j),[y,j]),a.useEffect(()=>nt(c),[c]),a.createElement(ot,{basename:r,children:u,location:d.location,navigationType:d.action,navigator:y,future:c})}var pe;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(pe||(pe={}));var ve;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ve||(ve={}));const Ae=a.createContext(void 0),re=()=>{const t=a.useContext(Ae);if(t===void 0)throw new Error("useETF must be used within an ETFProvider");return t},mt=({children:t})=>{const[r,u]=a.useState("QQQ"),[c,n]=a.useState([]),[h,y]=a.useState(!1),[d,i]=a.useState(null),S=a.useCallback(async()=>{try{y(!0),i(null);const w=await fetch("/api/symbols?limit=100");if(w.ok){const N=await w.json();N.status==="success"?n(N.symbols):i("Failed to fetch symbols")}else i("Failed to fetch symbols")}catch(w){console.error("Failed to fetch available ETFs:",w),i("Failed to fetch symbols")}finally{y(!1)}},[]),j=a.useCallback(async w=>{if(!w)return!1;try{if(c.some(g=>g.symbol.toUpperCase()===w.toUpperCase()))return!0;const b=await fetch(`/api/symbols/${w.toUpperCase()}`);return b.ok?(await b.json()).status==="success":!1}catch(N){return console.error("Error checking symbol validity:",N),!1}},[c]),F=a.useCallback(async w=>{if(!w)return!1;try{y(!0),i(null);const N=await fetch("/api/fetch-single-etf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:w.toUpperCase()})});if(N.ok){const b=await N.json();return b.status==="success"?(setTimeout(()=>{y(!1)},500),!0):(i(`Failed to fetch data for ${w}: ${b.message||"Unknown error"}`),y(!1),!1)}else return i(`Failed to fetch data for ${w}`),y(!1),!1}catch(N){return console.error("Error fetching stock data:",N),i(`Error fetching data for ${w}`),y(!1),!1}},[]);a.useEffect(()=>{S()},[S]);const _={selectedETF:r,setSelectedETF:u,availableETFs:c,fetchAvailableETFs:S,isValidETF:j,fetchStockData:F,isLoading:h,error:d};return e.jsx(Ae.Provider,{value:_,children:t})},Ie=a.createContext(void 0);function ut({children:t}){const[r,u]=a.useState(5),c=[{value:1,label:"1%",description:"Very mild corrections"},{value:1.5,label:"1.5%",description:"Minor corrections"},{value:2,label:"2%",description:"Small corrections"},{value:2.5,label:"2.5%",description:"Light corrections"},{value:3,label:"3%",description:"Mild corrections"},{value:4,label:"4%",description:"Moderate corrections"},{value:5,label:"5%",description:"Standard corrections"},{value:6,label:"6%",description:"Notable corrections"},{value:7,label:"7%",description:"Meaningful corrections"},{value:8,label:"8%",description:"Significant corrections"},{value:9,label:"9%",description:"Strong corrections"},{value:10,label:"10%",description:"Major corrections"},{value:12,label:"12%",description:"Large corrections"},{value:15,label:"15%",description:"Substantial drawdowns"},{value:18,label:"18%",description:"Major drawdowns"},{value:20,label:"20%",description:"Bear market territory"},{value:25,label:"25%",description:"Severe bear markets"},{value:30,label:"30%",description:"Extreme drawdowns"}];return e.jsx(Ie.Provider,{value:{threshold:r,setThreshold:u,availableThresholds:c},children:t})}function ae(){const t=a.useContext(Ie);if(t===void 0)throw new Error("useThreshold must be used within a ThresholdProvider");return t}const Oe=a.createContext(void 0);function ht({children:t}){const{selectedETF:r}=re(),{threshold:u}=ae(),[c,n]=a.useState([]),[h,y]=a.useState(null),[d,i]=a.useState(!1),[S,j]=a.useState(null),F=a.useCallback(async N=>{i(!0),j(null);try{const b=await fetch(`/api/cycles/${N}/${r}`);if(!b.ok)throw new Error("Failed to fetch cycles data");const g=await b.json();n(g.cycles)}catch(b){j(b instanceof Error?b.message:"An error occurred")}finally{i(!1)}},[r]),_=a.useCallback(async N=>{i(!0),j(null);try{const b=await fetch(`/api/summary/${N}/${r}`);if(!b.ok)throw new Error("Failed to fetch summary data");const g=await b.json();y(g)}catch(b){j(b instanceof Error?b.message:"An error occurred")}finally{i(!1)}},[r]);a.useEffect(()=>{r&&u&&(F(u),_(u))},[r,u,F,_]);const w=()=>j(null);return e.jsx(Oe.Provider,{value:{cycles:c,summary:h,isLoading:d,error:S,fetchCycles:F,fetchSummary:_,clearError:w},children:t})}function xt(){const t=a.useContext(Oe);if(t===void 0)throw new Error("useData must be used within a DataProvider");return t}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var gt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),M=(t,r)=>{const u=a.forwardRef(({color:c="currentColor",size:n=24,strokeWidth:h=2,absoluteStrokeWidth:y,className:d="",children:i,...S},j)=>a.createElement("svg",{ref:j,...gt,width:n,height:n,stroke:c,strokeWidth:y?Number(h)*24/Number(n):h,className:["lucide",`lucide-${ft(t)}`,d].join(" "),...S},[...r.map(([F,_])=>a.createElement(F,_)),...Array.isArray(i)?i:[i]]));return u.displayName=`${t}`,u};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=M("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=M("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=M("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=M("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=M("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=M("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=M("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=M("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=M("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function wt({selectedSymbol:t}){const{threshold:r,availableThresholds:u,setThreshold:c}=ae(),{cycles:n,fetchCycles:h,isLoading:y,error:d}=xt(),{selectedETF:i,setSelectedETF:S}=re();console.log("🔍 Cycles component - Debug info:",{threshold:r,availableThresholds:(u==null?void 0:u.length)||0,selectedETF:i,selectedSymbol:t});const[j,F]=a.useState(""),[_,w]=a.useState("all"),[N,b]=a.useState("ath_date"),[g,m]=a.useState("desc"),[s,$]=a.useState(null),[T,R]=a.useState(null),[I,Y]=a.useState(null);a.useEffect(()=>{t&&t!==i&&(console.log(`🔄 Setting selected ETF to ${t} from Dashboard`),S(t))},[t,i,S]);const Z=async()=>{if(i)try{console.log(`🔍 Fetching current price for ${i}...`);const o=await fetch(`/api/chart-data/${r}/${i}`);if(o.ok){const x=await o.json();if(console.log("📊 Chart data response:",x),x&&x.data&&x.data.length>0){const k=x.data[x.data.length-1].close;console.log(`✅ Using latest price from chart data: $${k}`),R(k);return}else console.log(`⚠️ No price data in chart-data response for ${i}`)}else console.log(`⚠️ Chart data request failed: ${o.status}`);console.log(`🔄 Fetching fresh price data for ${i} from Stooq...`);const E=await fetch(`/api/fetch-historical-data/${i}`);if(E.ok){const x=await E.json();if(console.log("📊 Stooq response:",x),x.status==="success"&&x.data&&x.data.length>0){const k=x.data[x.data.length-1].close;console.log(`✅ Using latest price from Stooq: $${k}`),R(k)}else console.error(`❌ Failed to get price data for ${i}:`,x)}else console.error(`❌ Stooq API request failed for ${i}:`,E.status);if(!T&&n&&n.length>0){console.log(`🔄 Last resort: Using most recent cycle data for ${i}`);const x=n[0];x.recovery_price?(console.log(`✅ Using recovery price from most recent cycle: $${x.recovery_price}`),R(x.recovery_price)):x.low_price&&(console.log(`✅ Using low price from most recent cycle as current: $${x.low_price}`),R(x.low_price))}}catch(o){if(console.error("❌ Error fetching current price:",o),!T&&n&&n.length>0){console.log(`🔄 Error fallback: Using cycle data for ${i}`);const E=n[0];E.recovery_price?R(E.recovery_price):E.low_price&&R(E.low_price)}}};a.useEffect(()=>{i&&h(r)},[r,i,h]),a.useEffect(()=>{t&&t!==i&&(console.log(`🔄 Dashboard integration: Fetching cycles for ${t}`),h(r))},[t,r,h]),a.useEffect(()=>{Z()},[i]);const X=async()=>{if(i)try{const o=await fetch(`/api/chart-data/${r}/${i}`);if(o.ok){const E=await o.json();Y(E)}else console.error("Failed to fetch chart data")}catch(o){console.error("Error fetching chart data:",o)}};a.useEffect(()=>{s&&X()},[s,i,r]);const f=n.filter(o=>{const E=o.cycle_number.toString().includes(j)||o.severity.toLowerCase().includes(j.toLowerCase())||o.ath_date.includes(j)||o.low_date.includes(j),x=_==="all"||o.severity.toLowerCase()===_.toLowerCase();return E&&x}).sort((o,E)=>{const x=o[N],k=E[N];return typeof x=="string"&&typeof k=="string"?g==="asc"?x.localeCompare(k):k.localeCompare(x):typeof x=="number"&&typeof k=="number"?g==="asc"?x-k:k-x:0}),v=o=>{N===o?m(g==="asc"?"desc":"asc"):(b(o),m("asc"))},P=()=>{const E=[["Cycle","Severity","ATH Date","ATH Price","Low Date","Low Price","Recovery Date","Recovery Price","Drawdown %","ATH to Low (Days)","Low to Recovery (Days)"].join(","),...f.map(C=>[C.cycle_number,C.severity,C.ath_date,C.ath_price,C.low_date,C.low_price,C.recovery_date||"",C.recovery_price||"",C.drawdown_pct,U(C.ath_date,C.low_date),C.recovery_date?U(C.low_date,C.recovery_date):"Ongoing"].join(","))].join(`
`),x=new Blob([E],{type:"text/csv"}),k=window.URL.createObjectURL(x),A=document.createElement("a");A.href=k,A.download=`${i.toLowerCase()}_cycles_${r}pct.csv`,A.click(),window.URL.revokeObjectURL(k)},L=o=>({severe:"bg-red-100 text-red-800",moderate:"bg-yellow-100 text-yellow-800",mild:"bg-green-100 text-green-800"})[o.toLowerCase()]||"bg-blue-100 text-blue-800",q=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Q=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),U=(o,E)=>{if(!o||!E)return 0;const x=new Date(o),k=new Date(E),A=Math.abs(k.getTime()-x.getTime());return Math.ceil(A/(1e3*60*60*24))},z=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),J=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(o),O=()=>{if(!I||!s)return[];const o=new Date(s.ath_date),E=s.recovery_date?new Date(s.recovery_date):new Date,x=30,k=new Date(o.getTime()-x*24*60*60*1e3),A=new Date(E.getTime()+x*24*60*60*1e3);return I.data.filter(C=>{const K=new Date(C.date);return K>=k&&K<=A})};return y?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):d?e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx(G,{className:"w-16 h-16 mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d}),e.jsx("button",{onClick:()=>h(r),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]})}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:[i," Drawdown Cycles"]}),e.jsxs("p",{className:"text-gray-600",children:[r,"%+ threshold • ",n.length," total cycles"]}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"💡 Click on any row to view detailed analysis for that cycle"})]}),e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Current Threshold"}),e.jsxs("div",{className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-lg font-bold",children:[r,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Cycles Found"}),e.jsx("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded-full text-lg font-bold",children:n.length})]}),e.jsx("div",{className:"text-sm text-gray-500 text-center",children:"💡 Use the threshold selector above to change the threshold and refresh cycles"})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search cycles...",value:j,onChange:o=>F(o.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pl-10"})]}),e.jsxs("select",{value:_,onChange:o=>w(o.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-xs",children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"severe",children:"Severe"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"mild",children:"Mild"})]})]}),e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",f.length," of ",n.length," cycles"]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:[{key:"cycle_number",label:"Cycle",sortable:!0},{key:"severity",label:"Severity",sortable:!0},{key:"ath_date",label:"ATH Date",sortable:!0},{key:"ath_price",label:"ATH Price",sortable:!0},{key:"low_date",label:"Low Date",sortable:!0},{key:"low_price",label:"Low Price",sortable:!0},{key:"drawdown_pct",label:"Drawdown %",sortable:!0},{key:"ath_to_low_days",label:"ATH→Low",sortable:!0},{key:"low_to_recovery_days",label:"Low→Recovery",sortable:!0}].map(o=>e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 ${o.sortable?"cursor-pointer":""}`,onClick:()=>o.sortable&&v(o.key),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:o.label}),o.sortable&&N===o.key&&e.jsx("span",{className:"text-primary-600",children:g==="asc"?"↑":"↓"})]})},o.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((o,E)=>e.jsxs(Ne.Fragment,{children:[e.jsxs("tr",{className:`cursor-pointer transition-colors ${(s==null?void 0:s.cycle_number)===o.cycle_number?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-gray-50"}`,onClick:()=>$((s==null?void 0:s.cycle_number)===o.cycle_number?null:o),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:o.cycle_number}),(s==null?void 0:s.cycle_number)===o.cycle_number&&e.jsx(B,{className:"w-4 h-4 ml-2 text-blue-500"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${L(o.severity)}`,children:o.severity})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(o.ath_date).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",o.ath_price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(o.low_date).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",o.low_price.toFixed(2)]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[o.drawdown_pct.toFixed(1),"%"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("span",{className:"font-medium text-gray-700",children:[U(o.ath_date,o.low_date)," days"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o.recovery_date?e.jsxs("span",{className:"font-medium text-green-600",children:[U(o.low_date,o.recovery_date)," days"]}):e.jsx("span",{className:"text-gray-400 italic",children:"Ongoing"})})]}),(s==null?void 0:s.cycle_number)===o.cycle_number&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:9,className:"px-6 py-4",children:e.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start p-4 border-b border-blue-200",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2 text-blue-500"}),"Cycle ",s.cycle_number," Analysis - ",q(s.ath_date)]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Detailed breakdown of this ",s.severity.toLowerCase()," drawdown cycle"]})]}),e.jsx("button",{onClick:()=>$(null),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(vt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 flex items-center text-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-green-500"}),"All-Time High"]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:Q(s.ath_price)}),e.jsx("p",{className:"text-xs text-gray-600",children:q(s.ath_date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 flex items-center text-sm",children:[e.jsx(G,{className:"w-4 h-4 mr-2 text-red-500"}),"Low Point"]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-red-600",children:Q(s.low_price)}),e.jsx("p",{className:"text-xs text-gray-600",children:q(s.low_date)}),e.jsxs("p",{className:"text-xs text-red-600 font-medium",children:[s.drawdown_pct.toFixed(1),"% drawdown"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 flex items-center text-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-blue-500"}),"Recovery"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:s.recovery_price?Q(s.recovery_price):"Ongoing"}),e.jsx("p",{className:"text-xs text-gray-600",children:s.recovery_date?q(s.recovery_date):"Not recovered yet"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 flex items-center text-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-purple-500"}),"Current Price"]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["$",(T==null?void 0:T.toFixed(2))||"Fetching..."]}),T&&e.jsxs("div",{className:"text-xs space-y-1 mt-2",children:[e.jsxs("div",{className:`flex items-center ${T>=s.ath_price?"text-green-600":"text-red-600"}`,children:[e.jsx("span",{className:"mr-1",children:T>=s.ath_price?"↗":"↘"}),T>=s.ath_price?"Above ATH":"Below ATH"]}),e.jsxs("div",{className:`flex items-center ${T>=s.low_price?"text-green-600":"text-red-600"}`,children:[e.jsx("span",{className:"mr-1",children:T>=s.low_price?"↗":"↘"}),T>=s.low_price?"Above Low":"Below Low"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Last traded: ",T?"Available":"Fetching..."]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 p-3 rounded-lg",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-3 flex items-center text-sm",children:[e.jsx(we,{className:"w-4 h-4 mr-2 text-gray-500"}),"Timeline"]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ATH to Low:"}),e.jsxs("span",{className:"font-medium",children:[U(s.ath_date,s.low_date)," days"]})]}),s.recovery_date&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Low to Recovery:"}),e.jsxs("span",{className:"font-medium",children:[U(s.low_date,s.recovery_date)," days"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total Cycle:"}),e.jsxs("span",{className:"font-bold",children:[U(s.ath_date,s.recovery_date)," days"]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 p-3 rounded-lg",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-3 flex items-center text-sm",children:[e.jsx(G,{className:"w-4 h-4 mr-2 text-gray-500"}),"Price Changes"]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ATH to Low:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[((s.low_price-s.ath_price)/s.ath_price*100).toFixed(1),"%"]})]}),s.recovery_price&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Low to Recovery:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[((s.recovery_price-s.low_price)/s.low_price*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Net Change:"}),e.jsxs("span",{className:`font-bold ${s.recovery_price>=s.ath_price?"text-green-600":"text-red-600"}`,children:[((s.recovery_price-s.ath_price)/s.ath_price*100).toFixed(1),"%"]})]})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-3 h-3 rounded-full mt-1 ${s.severity==="severe"?"bg-red-500":s.severity==="moderate"?"bg-yellow-500":"bg-green-500"}`})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[s.severity.charAt(0).toUpperCase()+s.severity.slice(1)," Drawdown Cycle"]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["This cycle represents a ",s.drawdown_pct.toFixed(1),"% decline from the all-time high,",s.recovery_date?` which took ${U(s.ath_date,s.recovery_date)} days to fully recover.`:" and is currently ongoing without full recovery."]})]})]})}),I&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-4 flex items-center text-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-blue-500"}),"Cycle Price Chart"]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"h-80",children:e.jsx(Se,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:O(),children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Fe,{dataKey:"date",tickFormatter:x=>z(x),tick:{fontSize:10},stroke:"#6b7280"}),e.jsx(Ee,{tickFormatter:x=>`$${x.toFixed(0)}`,tick:{fontSize:10},stroke:"#6b7280"}),e.jsx(ke,{content:({active:x,payload:k,label:A})=>{if(x&&k&&k.length){const C=k[0].value,K=typeof C=="number"?C.toFixed(2):String(C);return e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:z(A)}),e.jsxs("p",{className:"text-blue-600",children:[i,": $",K]})]})}return null}}),e.jsx(Be,{type:"monotone",dataKey:"close",stroke:"#2563eb",fill:"#dbeafe",strokeWidth:2,fillOpacity:.3}),e.jsx(ie,{x:s.ath_date,stroke:"#ef4444",strokeDasharray:"3 3",strokeWidth:2,label:{value:`ATH: ${J(s.ath_price)}`,position:"top",fill:"#ef4444",fontSize:10}}),e.jsx(ie,{x:s.low_date,stroke:"#dc2626",strokeDasharray:"3 3",strokeWidth:2,label:{value:`Low: ${J(s.low_price)}`,position:"bottom",fill:"#dc2626",fontSize:10}}),s.recovery_date&&e.jsx(ie,{x:s.recovery_date,stroke:"#059669",strokeDasharray:"3 3",strokeWidth:2,label:{value:`Recovery: ${J(s.recovery_price)}`,position:"top",fill:"#059669",fontSize:10}}),e.jsx(He,{x1:s.ath_date,x2:s.recovery_date||new Date().toISOString().split("T")[0],fill:"#fef3c7",fillOpacity:.3,stroke:"none"})]})})}),e.jsxs("div",{className:"mt-3 text-xs text-gray-600 text-center",children:[e.jsx("span",{className:"inline-block w-3 h-3 bg-red-500 rounded-full mr-1"}),"ATH •",e.jsx("span",{className:"inline-block w-3 h-3 bg-red-600 rounded-full mx-1"}),"Low •",e.jsx("span",{className:"inline-block w-3 h-3 bg-green-600 rounded-full mx-1"}),"Recovery •",e.jsx("span",{className:"inline-block w-3 h-3 bg-yellow-200 rounded-full mx-1"}),"Cycle Period"]})]})]})]})]})})})]},o.cycle_number))})]})}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No cycles found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria."})]})]})]})}const jt=({selectedSymbol:t})=>{const{threshold:r,setThreshold:u,availableThresholds:c}=ae(),{selectedETF:n,availableETFs:h,isLoading:y}=re(),[d,i]=a.useState({baseETF:t||"",leveragedETF:"",description:"",leverageRatio:"Custom"}),[S,j]=a.useState([]),[F,_]=a.useState(1e4),[w,N]=a.useState("2020-01-01"),[b,g]=a.useState(new Date().toISOString().split("T")[0]),[m,s]=a.useState(null),[$,T]=a.useState(!1),[R,I]=a.useState(null),[Y,Z]=a.useState(!1),[X,f]=a.useState(""),[v,P]=a.useState(1e3),[L,q]=a.useState(!0),[Q,U]=a.useState(!1),[z,J]=a.useState(5),[O,o]=a.useState(""),[E,x]=a.useState(!1),[k,A]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const p=await fetch("/api/available-etfs");if(p.ok){const D=await p.json();j(D.etfPairs||[])}}catch(p){console.error("Failed to fetch ETF pairs:",p)}})()},[]),a.useEffect(()=>{if(t&&t!==d.baseETF){console.log(`🔄 Setting base ETF to ${t} from Dashboard`),i(D=>({...D,baseETF:t,leveragedETF:"",description:"",leverageRatio:"Custom"})),I(null),s(null),o("");const l=new Date,p=new Date(l.getFullYear()-5,l.getMonth(),l.getDate());N(p.toISOString().split("T")[0]),g(l.toISOString().split("T")[0]),console.log(`🧹 Cleared all states for new symbol: ${t}`),console.log(`📅 Auto-set date range: ${p.toISOString().split("T")[0]} to ${l.toISOString().split("T")[0]}`)}},[t,d.baseETF]),a.useEffect(()=>{if(new URLSearchParams(window.location.hash.split("?")[1]).get("autoRun")==="true"&&t&&!$&&!m){console.log(`🚀 Auto-running simulation for ${t} from Dashboard`);const D=new Date,V=new Date(D.getFullYear()-5,D.getMonth(),D.getDate());N(V.toISOString().split("T")[0]),g(D.toISOString().split("T")[0]),setTimeout(()=>{C()},500)}},[t,$,m]),a.useEffect(()=>{if(h.length>0){const l=[],p={QQQ:"TQQQ",SPY:"UPRO",IWM:"TNA"};h.forEach(D=>{if(p[D.symbol]){const V=p[D.symbol];h.some(ee=>ee.symbol===V)&&l.push({baseETF:D.symbol,leveragedETF:V,description:`${D.name} vs 3x Leveraged`,leverageRatio:"3x"})}}),h.length>=2&&h.forEach((D,V)=>{h.slice(V+1).forEach(ee=>{l.push({baseETF:D.symbol,leveragedETF:ee.symbol,description:`${D.symbol} vs ${ee.symbol}`,leverageRatio:"Custom"})})}),j(l)}},[h]);const C=async()=>{if(!F||!w||!b){I("Please fill in all required fields");return}if(!d.baseETF){I("Please select a base symbol");return}T(!0),I(null),console.log(`🚀 Starting simulation for ${d.baseETF}`);try{console.log(`📡 Running initial simulation using /api/simulate for ${d.baseETF}`);const l=await fetch("/api/simulate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:F,startDate:w,endDate:b,threshold:5,monthlyInvestment:L?v:0,baseETF:d.baseETF,leveragedETF:d.baseETF})});if(!l.ok){const V=await l.json();throw new Error(V.error||"Initial simulation failed")}const p=await l.json(),D={startDate:w,endDate:b,initialInvestment:F,monthlyInvestment:L?v:void 0,totalInvested:p.totalInvested||p.initialInvestment,strategy:`Buy and Hold ${d.baseETF}`,baseETFFinalValue:p.baseETFFinalValue||p.qqqFinalValue||0,baseETFTotalReturn:(p.baseETFFinalValue||p.qqqFinalValue||0)-(p.totalInvested||p.initialInvestment),baseETFTotalReturnPct:p.baseETFTotalReturnPct||p.qqqTotalReturnPct||0,baseETFAnnualizedReturn:p.baseETFAnnualizedReturn||p.qqqAnnualizedReturn||0,durationDays:p.durationDays||0,durationYears:p.durationYears||0,strategySwitches:0};s(D),console.log("Initial simulation result (using smart strategy logic):",D)}catch(l){const p=l instanceof Error?l.message:"Simulation failed";console.log(`❌ Setting error: ${p}`),I(p)}finally{T(!1)}},K=async()=>{if(!d.baseETF||!O){I("Please select both base and secondary symbols");return}T(!0),I(null);try{const l=await fetch("/api/simulate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:F,startDate:w,endDate:b,threshold:z,monthlyInvestment:L?v:0,baseETF:d.baseETF,leveragedETF:O})});if(!l.ok){const D=await l.json();throw new Error(D.error||"Smart strategy simulation failed")}const p=await l.json();s(p)}catch(l){I(l instanceof Error?l.message:"Smart strategy simulation failed")}finally{T(!1)}},W=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(l),le=l=>`${l>=0?"+":""}${l.toFixed(2)}%`,he=l=>`${l>=0?"+":""}${l.toFixed(1)}%`,ne=l=>l>=0?"text-green-600":"text-red-600",oe=l=>l>=0?"bg-green-50 border-green-200":"bg-red-50 border-red-200";return y||h.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"w-16 h-16 text-gray-400 mx-auto mb-4 animate-spin"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Simulation..."}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we load available symbols."})]})})}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Portfolio Simulation - ",t]}),e.jsx("p",{className:"text-gray-600",children:"Compare different investment strategies and see how they would have performed historically."})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-4 lg:gap-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Simulation Parameters"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Smart Strategy Symbols"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Base Symbol (Primary)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d.baseETF,onChange:l=>{const p=l.target.value;i({...d,baseETF:p,description:`${p} vs ${d.leveragedETF}`,leverageRatio:"Custom"}),x(p.length>0),s(null)},onFocus:()=>x(d.baseETF.length>0),onBlur:()=>setTimeout(()=>x(!1),200),onKeyPress:l=>{l.key==="Enter"&&x(!1)},placeholder:"Type symbol (e.g., QQQ, AAPL, TSLA)...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"}),E&&d.baseETF&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:h.filter(l=>l.symbol.toLowerCase().includes(d.baseETF.toLowerCase())||l.name.toLowerCase().includes(d.baseETF.toLowerCase())).slice(0,10).map(l=>e.jsxs("div",{onClick:()=>{i({...d,baseETF:l.symbol,description:`${l.symbol} vs ${d.leveragedETF}`,leverageRatio:"Custom"}),x(!1),s(null)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.symbol}),e.jsx("div",{className:"text-xs text-gray-500",children:l.name})]},l.symbol))})]})]}),d.baseETF&&e.jsxs("div",{className:"p-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Symbol:"})," ",d.baseETF]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ready to simulate performance"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Initial Investment"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(je,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",value:F,onChange:l=>_(Number(l.target.value)),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"10000",min:"100",step:"100"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:w,onChange:l=>N(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"date",value:b,onChange:l=>g(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",id:"monthlyInvestment",checked:L,onChange:l=>q(l.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"monthlyInvestment",className:"ml-2 text-sm font-medium text-gray-700",children:"Add Monthly Investment"})]}),L&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(je,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",value:v,onChange:l=>P(Number(l.target.value)),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"1000",min:"100",step:"100"})]})]}),e.jsx("button",{onClick:C,disabled:$,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:$?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"-ml-1 mr-2 h-4 w-4"}),"Run Simulation"]})}),R&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:R})})]})}),e.jsx("div",{className:"xl:col-span-3",children:m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4",children:[e.jsx("div",{className:`bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-3 lg:p-4 min-w-0 min-h-[140px] ${oe(m.baseETFFinalValue&&m.baseETFTotalReturnPct||0)}`,children:e.jsxs("div",{className:"text-center min-w-0 h-full flex flex-col justify-center",children:[e.jsxs("h4",{className:"text-xs lg:text-sm font-medium text-gray-600 mb-2 truncate",children:[d.baseETF," Only"]}),e.jsx("p",{className:"text-base lg:text-lg xl:text-xl font-bold text-gray-900 mb-1 break-words leading-tight min-h-[2.5rem] flex items-center justify-center",children:W(m.baseETFFinalValue||m.qqqFinalValue||0)}),e.jsx("p",{className:`text-xs lg:text-sm font-medium ${ne(m.baseETFTotalReturnPct||m.qqqTotalReturnPct||0)} min-h-[1.5rem] flex items-center justify-center`,children:le(m.baseETFTotalReturnPct||m.qqqTotalReturnPct||0)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 break-words min-h-[1rem] flex items-center justify-center",children:[he(m.baseETFAnnualizedReturn||m.qqqAnnualizedReturn||0)," annually"]})]})}),e.jsx("div",{className:`bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-3 lg:p-4 min-w-0 min-h-[140px] ${oe(m.leveragedETFFinalValue&&m.leveragedETFTotalReturnPct||0)}`,children:e.jsxs("div",{className:"text-center min-w-0 h-full flex flex-col justify-center",children:[e.jsxs("h4",{className:"text-xs lg:text-sm font-medium text-gray-600 mb-2 truncate",children:[d.leveragedETF," Only"]}),e.jsx("p",{className:"text-base lg:text-lg xl:text-xl font-bold text-gray-900 mb-1 break-words leading-tight min-h-[2.5rem] flex items-center justify-center",children:W(m.leveragedETFFinalValue||m.tqqqFinalValue||0)}),e.jsx("p",{className:`text-xs lg:text-sm font-medium ${ne(m.leveragedETFTotalReturnPct||m.tqqqTotalReturnPct||0)} min-h-[1.5rem] flex items-center justify-center`,children:le(m.leveragedETFTotalReturnPct||m.tqqqTotalReturnPct||0)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 break-words min-h-[1rem] flex items-center justify-center",children:[he(m.leveragedETFAnnualizedReturn||m.tqqqAnnualizedReturn||0)," annually"]})]})}),m.strategyFinalValue&&e.jsx("div",{className:`bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-3 lg:p-4 min-w-0 min-h-[140px] ${oe(m.strategyTotalReturnPct||0)}`,children:e.jsxs("div",{className:"text-center min-w-0 h-full flex flex-col justify-center",children:[e.jsx("h4",{className:"text-xs lg:text-sm font-medium text-gray-600 mb-2 truncate",children:"Smart Strategy"}),e.jsx("p",{className:"text-base lg:text-lg xl:text-xl font-bold text-gray-900 mb-1 break-words leading-tight min-h-[2.5rem] flex items-center justify-center",children:W(m.strategyFinalValue)}),e.jsx("p",{className:`text-xs lg:text-sm font-medium ${ne(m.strategyTotalReturnPct||0)} min-h-[1.5rem] flex items-center justify-center`,children:le(m.strategyTotalReturnPct||0)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 break-words min-h-[1rem] flex items-center justify-center",children:[m.strategySwitches," switches"]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-3 lg:p-4",children:[e.jsx("h3",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:"Detailed Results"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2 lg:mb-3 text-sm lg:text-base",children:"Investment Summary"}),e.jsxs("div",{className:"space-y-2 text-xs lg:text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Initial Investment:"}),e.jsx("span",{className:"font-medium text-right break-words",children:W(m.initialInvestment)})]}),m.monthlyInvestment&&e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Monthly Investment:"}),e.jsx("span",{className:"font-medium text-right break-words",children:W(m.monthlyInvestment)})]}),e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Total Invested:"}),e.jsx("span",{className:"font-medium text-right break-words",children:W(m.totalInvested||m.initialInvestment)})]}),e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Duration:"}),e.jsxs("span",{className:"font-medium text-right break-words",children:[(m.durationYears||0).toFixed(1)," years"]})]})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2 lg:mb-3 text-sm lg:text-base",children:"Strategy Details"}),e.jsxs("div",{className:"space-y-2 text-xs lg:text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Strategy:"}),e.jsx("span",{className:"font-medium text-blue-600 text-right break-words",children:m.strategy})]}),e.jsxs("div",{className:"flex justify-between items-center min-w-0",children:[e.jsx("span",{className:"truncate mr-2",children:"Switches:"}),e.jsx("span",{className:"font-medium",children:m.strategySwitches||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Threshold:"}),e.jsxs("span",{className:"font-medium",children:[r,"%"]})]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Smart Strategy Options"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Configure smart switching strategy parameters to see how switching between symbols during drawdowns affects returns."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Symbol (Switch Target)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:O,onChange:l=>{o(l.target.value),A(l.target.value.length>0)},onFocus:()=>A(O.length>0),onBlur:()=>setTimeout(()=>A(!1),200),onKeyPress:l=>{l.key==="Enter"&&A(!1)},placeholder:"Type symbol (e.g., QQQ, AAPL, TSLA)...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),k&&O&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:h.filter(l=>l.symbol.toLowerCase().includes(O.toLowerCase())||l.name.toLowerCase().includes(O.toLowerCase())).slice(0,10).map(l=>e.jsxs("div",{onClick:()=>{o(l.symbol),A(!1)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.symbol}),e.jsx("div",{className:"text-xs text-gray-500",children:l.name})]},l.symbol))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Drawdown Threshold"}),e.jsx("select",{value:z,onChange:l=>J(Number(l.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:c.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),O&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>K(),disabled:$,className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:$?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Running Smart Strategy..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"-ml-1 mr-2 h-4 w-4"}),"Run Smart Strategy: ",d.baseETF," ↔ ",O]})})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Strategy Explanation"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Smart Strategy:"})," Start with ",d.baseETF,", switch to ",O||"secondary symbol"," when ",d.baseETF," drops ",z,"%+ from its all-time high, then switch back to ",d.baseETF," when ",d.baseETF," recovers to a new all-time high."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Rationale:"})," ",O||"Secondary symbol","'s leverage amplifies both gains and losses. During major drawdowns, the strategy aims to capture ",O||"secondary symbol","'s amplified recovery while avoiding prolonged exposure to leverage decay."]}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Period: ",m.startDate," to ",m.endDate,"(",(m.durationYears||0).toFixed(1)," years)"]})]})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg shadow-sm border border-gray-200 p-4 text-center py-8",children:[e.jsx(B,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ready to Simulate"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'Enter your investment parameters and click "Run Simulation" to see how different strategies would have performed.'}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[d.baseETF?e.jsxs("p",{children:["• Simulate ",d.baseETF," performance"]}):e.jsx("p",{children:"• Select a symbol to simulate performance"}),e.jsx("p",{children:"• Configure smart switching strategies after initial simulation"}),e.jsx("p",{children:"• See detailed return calculations"})]})]})})]})]})};function Nt(){const{selectedETF:t,setSelectedETF:r}=re(),{threshold:u,setThreshold:c}=ae(),[n,h]=a.useState(""),[y,d]=a.useState([]),[i,S]=a.useState(null),[j,F]=a.useState(!1),[_,w]=a.useState(null),[N,b]=a.useState(!1),[g,m]=a.useState(""),[s,$]=a.useState("1Y"),[T,R]=a.useState([]),I=[{value:"1M",label:"1 Month"},{value:"3M",label:"3 Months"},{value:"6M",label:"6 Months"},{value:"1Y",label:"1 Year"},{value:"2Y",label:"2 Years"},{value:"5Y",label:"5 Years"},{value:"MAX",label:"Max"}],Y=f=>{h(f),r(f),b(!1),m("")},Z=async f=>{if(f.length<2){R([]);return}console.log(`🔍 Searching for symbols: "${f}"`);try{const v=await fetch(`/api/symbols?query=${encodeURIComponent(f)}&limit=20`);if(console.log(`📡 API response status: ${v.status}`),v.ok){const P=await v.json();console.log("📊 API response data:",P),P.status==="success"&&Array.isArray(P.symbols)?(console.log(`✅ Found ${P.symbols.length} symbols`),R(P.symbols)):(console.warn("⚠️ API returned unexpected data format:",P),R([]))}else console.warn(`⚠️ API request failed: ${v.status}`),R([])}catch(v){console.error("❌ Error searching symbols:",v),R([])}};a.useEffect(()=>{const f=setTimeout(()=>{g&&Z(g)},300);return()=>clearTimeout(f)},[g]);const X=async()=>{if(n){F(!0),w(null);try{const f=await fetch(`/api/chart-data/${u}/${n}`);if(!f.ok)throw new Error(`Failed to fetch data for ${n}`);const v=await f.json();if(v.data&&Array.isArray(v.data)){if(d(v.data),v.data.length>0){const P=v.data[v.data.length-1],L=v.data[0],q=P.close-L.close,Q=q/L.close*100;S({name:v.name||n,currentPrice:P.close,change:q,changePercent:Q,volume:P.volume||0,dataPoints:v.data.length,dateRange:`${new Date(L.date).toLocaleDateString()} - ${new Date(P.date).toLocaleDateString()}`})}}else d([]),S(null)}catch(f){w(f instanceof Error?f.message:"Failed to fetch data"),d([]),S(null)}finally{F(!1)}}};return a.useEffect(()=>{n&&X()},[n,u]),e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-none px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Stock Analysis Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Analyze stock performance, cycles, and simulate investment strategies"})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 p-6 shadow-xl mb-8",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Stock Symbol"}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:g,onChange:f=>m(f.target.value),onFocus:()=>b(!0),onBlur:()=>setTimeout(()=>b(!1),200),onKeyPress:f=>{f.key==="Enter"&&(T.length>0?Y(T[0].symbol):g.trim()&&Y(g.trim().toUpperCase()))},placeholder:"Enter symbol (e.g., QQQ, AAPL)",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),N&&g.length>=2&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:T.length>0?T.map(f=>e.jsxs("div",{onClick:()=>Y(f.symbol),className:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.symbol}),e.jsx("div",{className:"text-sm text-gray-600",children:f.name})]},f.symbol)):e.jsx("div",{className:"px-4 py-3 text-gray-500 text-center",children:T.length===0&&g.length>=2?"No symbols found":"Type to search..."})})]})]})}),n&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"xl:col-span-3 bg-white rounded-2xl border border-gray-100 p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[n," Price Chart"]}),i&&e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["$",i.currentPrice.toFixed(2)]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-sm font-medium ${i.change>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[i.change>=0?"+":"",i.change.toFixed(2)," (",i.changePercent.toFixed(2),"%)"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-lg",children:I.map(f=>e.jsx("button",{onClick:()=>$(f.value),className:`px-3 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${s===f.value?"bg-white text-blue-600 shadow-md border border-blue-200":"text-gray-600 hover:text-gray-900 hover:bg-white"}`,children:f.label},f.value))})]}),j?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading chart data..."})]}):_?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(G,{className:"w-10 h-10 text-red-600"})}),e.jsx("p",{className:"text-red-600 font-medium text-lg",children:_}),e.jsx("button",{onClick:X,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]}):y.length>0?e.jsx("div",{className:"h-80",children:e.jsx(Se,{width:"100%",height:"100%",children:e.jsxs(Ye,{data:y,children:[e.jsx(Te,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Fe,{dataKey:"date",tickFormatter:f=>new Date(f).toLocaleDateString(),stroke:"#6b7280"}),e.jsx(Ee,{tickFormatter:f=>`$${f.toFixed(2)}`,stroke:"#6b7280"}),e.jsx(ke,{content:({active:f,payload:v,label:P})=>{if(f&&v&&v.length){const L=v[0].value,q=typeof L=="number"?L.toFixed(2):String(L);return e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:new Date(P).toLocaleDateString()}),e.jsxs("p",{className:"text-blue-600",children:[n,": $",q]})]})}return null}}),e.jsx(Qe,{type:"monotone",dataKey:"close",stroke:"#2563eb",strokeWidth:2,dot:!1})]})})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(yt,{className:"w-20 h-20 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No chart data available"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Try selecting a different symbol or date range"})]})]}),e.jsx("div",{className:"xl:col-span-2 bg-white rounded-2xl border border-gray-100 p-6 shadow-xl",children:e.jsx(jt,{selectedSymbol:n})})]}),n&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-lg w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Drawdown Threshold"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Set the threshold for cycle analysis"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-lg font-semibold text-gray-700",children:"Current Threshold:"}),e.jsxs("div",{className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-lg font-bold border border-blue-300",children:[u,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-lg font-semibold text-gray-700",children:"New Threshold:"}),e.jsx("input",{type:"number",min:"0.1",max:"99",step:"0.1",placeholder:"Enter % (e.g., 15.5)",className:"w-32 px-4 py-3 text-lg border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",onKeyPress:f=>{if(f.key==="Enter"){const v=f.target,P=parseFloat(v.value);P>=.1&&P<=99&&(c(P),v.value="")}}}),e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"%"}),e.jsx("button",{onClick:()=>{const f=document.querySelector('input[type="number"]');if(f){const v=parseFloat(f.value);v>=.1&&v<=99&&(c(v),f.value="")}},className:"px-6 py-3 bg-blue-600 text-white text-lg font-semibold rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:"Apply"})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:"💡 Enter any threshold from 0.1% to 99% and press Enter or click Apply"})})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 p-6 shadow-xl w-full",children:e.jsx(wt,{selectedSymbol:n})})]})]})})}function St(){return e.jsx(mt,{children:e.jsx(ut,{children:e.jsx(ht,{children:e.jsx(Nt,{})})})})}de.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsx(dt,{children:e.jsx(St,{})})}));
//# sourceMappingURL=index-Cdby5AzQ.js.map
